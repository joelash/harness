.PHONY: test docs

build :
	make build-assets
	make docs

build-assets :
	./script/env.sh coffee script/asset

build-tests :
	./script/env.sh coffee script/test

dev-server :
	./script/env.sh coffee script/mock-server

docs :
	./script/env.sh groc -e "./node_modules/**/*" "./**/*.coffee" README.md

install :
	./script/env.sh npm install

release :
	NODE_ENV=release make build-assets
	echo "//Generated by Harness"|cat - ./public/harness.js > /tmp/out && mv /tmp/out ./public/harness.js
	echo "/*Generated by Harness*/"|cat - ./public/harness.css > /tmp/out && mv /tmp/out ./public/harness.css

deploy :
	make release
	./script/env.sh coffee script/deploy

server :
	./script/env.sh coffee script/server

test :
	make build-tests
	./script/env.sh testem -f test/testem.json test

itest :
	make build-assets
	./script/env.sh coffee script/itest

watch-source :
	./script/env.sh watchman source "make build-assets"

watch-test :
	./script/env.sh watchman test "make build-tests"

reload :
	./script/env.sh coffee script/reload
